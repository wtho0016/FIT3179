{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
      "background": "transparent",
      "width": 800,
      "height": 450,
      "padding": {"bottom": 20},
      "config": {
        "title": {"font": "Oxygen", "fontSize": 18},"axis": {
        "labelFont": "Oxygen",
        "titleFont": "Oxygen",
        "labelFontSize": 12,
        "titleFontSize": 14
      },
      "legend": {
        "labelFont": "Oxygen",
        "titleFont": "Oxygen",
        "labelFontSize": 12,
        "titleFontSize": 14
      },
      "text": {
        "font": "Oxygen",
        "fontSize": 12
      },
        "view": {"stroke": "transparent", "fill": "transparent"},
        "padding": {"left": 150}
      },
      "data": { "url": "https://raw.githubusercontent.com/wtho0016/FIT3179/refs/heads/main/DV2/Data/Arrival.csv" },
      "transform": [
        {"filter": "datum.Top10Rank != null && datum.Top10Rank > 0 && datum.Top10Rank < 6"},
        {
          "window": [
            {"field": "Year", "op": "lag", "as": "prev_Year"}
          ],
          "groupby": ["Country"],
          "sort": [{"field": "Year", "order": "ascending"}]
        },
        {
          "calculate": "datum.prev_Year === null || datum.Year - datum.prev_Year > 1 ? 1 : 0",
          "as": "series_break"
        },
        {
          "calculate": "round(datum.rank)",
          "as": "rank_int"
        },
        {
          "window": [{"op": "sum", "field": "series_break", "as": "series_group"}],
          "groupby": ["Country"]
        }
      ],
      "layer": [
        {
          "mark": {
              "type": "line", 
              "point":{
                "size": 100,
                "filled": true
              },
              "strokeWidth": 2.5,
              "interpolate": "monotone"
          },
          "encoding": 
          {
            "x": 
            { 
              "field": "Year", 
              "type": "ordinal", 
              "axis": {
                "titlePadding": 15
              },
              "title": "Year"
            },
            "y": 
            { 
              "field": "Top10Rank", 
              "type": "ordinal", 
              "axis": {
                "title": "Rank",
                "titlePadding": 15,
                "format": "d" 
              },
              "sort": "ascending"
            },
            "color": {
              "field": "Country",
              "type": "nominal",
              "legend": {"title": "Country", "orient": "top"},
              "scale":{
                "range": [
                  "#FF6B6B",
                  "#FFA500",
                  "#FFD93D",
                  "#4169E1",
                  "#77c3ec",
                  "#8A2BE2",
                  "#FF69B4",
                  "#A0522D",
                  "#151B54"
                ]
              }
            },
            "detail": {
              "field": "series_group",
              "type": "nominal"
            },
            "tooltip": 
            [
            {"field": "Country", "type": "nominal"},
            {"field": "Year", "type": "ordinal"},
            {"field": "Value", "type": "quantitative", "title":"Arrivals (Thousands)"},
            {"field": "Top10Rank", "type": "ordinal","title":"Rank", "format":"d"}
          ]
        }
      },
      {
        "mark": {
          "type": "text",
          "dy":170, 
          "dx": -80,       
          "fontWeight": "bold",
          "fontSize": 12,
          "color": "black"
        },
        "transform": [
          {"filter": "datum.Country == 'CHINA' && datum.Top10Rank == 3 && datum.Year == 2019"}
        ,{"calculate": "'After 2019, China dropped; in rank due to nationwide; COVID-19 control measures'",
          "as": "text_annotation_raw"
          },
          {
          "calculate": "split(datum.text_annotation_raw,';')",
          "as": "annotation"
          }
        ],
          "encoding": {
          "x": {"field": "Year", "type": "ordinal"},
          "y": {"field": "Top10Rank", "type": "quantitative","axis":null},
          "text": {"field": "annotation"}
        }
      },
      {
        "mark": {
          "type": "text",
          "dy":75, 
          "dx": -80,       
          "fontWeight": "bold",
          "fontSize": 12,
          "color": "Black"
        },
        "transform": [
          {"filter": "datum.Country == 'UNITED STATES OF AMERICA' && datum.Top10Rank == 2 && datum.Year == 2010"}
        ,{"calculate": "'US rank rose in 2006 as; international arrivals recovered ;after post-9/11 declines'",
          "as": "text_annotation_raw"
          },
          {
          "calculate": "split(datum.text_annotation_raw,';')",
          "as": "annotation"
          }
        ],
          "encoding": {
          "x": {"field": "Year", "type": "ordinal"},
          "y": {"field": "Top10Rank", "type": "quantitative","axis":null},
          "text": {"field": "annotation"}
        }
      },
      {
        "transform": [
          {"filter": "datum.Year == 2022"},
          {
            "lookup": "Country",
            "from": {
              "data": {
                "values": [
                  {"Country": "SPAIN", "flag": "https://flagcdn.com/w40/es.png"},
                  {"Country": "ITALY", "flag": "https://flagcdn.com/w40/it.png"},
                  {"Country": "POLAND", "flag": "https://flagcdn.com/w40/pl.png"},
                  {"Country": "TÃœRKIYE", "flag": "https://flagcdn.com/w40/tr.png"},
                  {"Country": "MEXICO", "flag": "https://flagcdn.com/w40/mx.png"}
                ]
              },
              "key": "Country",
              "fields": ["flag"]
            }
          }
        ],
        "mark": {"type": "image", "width": 40, "xOffset": 50},
        "encoding": {
          "x": {"field": "Year", "type": "ordinal"},
          "y": {"field": "Top10Rank", "type": "ordinal","axis":null},
          "url": {"field": "flag"}
        }
      }
  ]
}